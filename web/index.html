<!DOCTYPE html>
<html>
    <head>
        <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
    </head>
    <body>
        <script>

            //This fn is imported in Rust! don't change the name!
            function handleResult(str) {
                console.log("Handling result in JS...\n" + str)
                console.log("Result size:" + str.length)
                document.getElementById("results").innerHTML = htmlEncode(str)
                download_file("results.ttl", str, "text/turtle")
            }

            function download_file(name, contents, mime_type) {
                // mime_type = mime_type || "application/json";
                var blob = new Blob([contents], {type: mime_type});

                var dlink = document.createElement('a');
                dlink.download = name;
                dlink.href = window.URL.createObjectURL(blob);
                dlink.onclick = function(e) {
                    // revokeObjectURL needs a delay to work properly
                    var that = this;
                    setTimeout(function() {
                        window.URL.revokeObjectURL(that.href);
                    }, 1500);
                };

                dlink.click();
                dlink.remove();
            }
        </script>

        <script type="module">
            import init, { analyze_file, analyze_string } from './wasm_oxi_time.js';        
            async function run() {
                await init();
              //From here on we can call functions defined in wasm.
              document.getElementById("file_chooser").onchange = function () { 
                const chooser = document.getElementById("file_chooser")
                console.log("File has been chosen.")
                analyze_file(chooser)
                chooser.value = null // this is needed otherwise the event will not fire if the user reloads the same file. Looks like it's safe to do it that way: https://stackoverflow.com/questions/3528359/html-input-type-file-file-selection-event
              }

              document.getElementById("send_data_button").onclick = function () {  
                console.log("Data submitted.")
                const data = document.getElementById("data_as_txt").value
                console.log("Data to send:\n"+ data)
                analyze_string(data)};
            }
            run();
        </script>


        <label for="avatar">Choose a file:</label>

        <input type="file"
               id="file_chooser" name="file_chooser"
               accept="text/csv, application/json">

        <form id="data_form">
                <p><label for="data_as_txt">Enter data:</label></p>
                <textarea id="data_as_txt" name="data_as_txt" rows="4" cols="150">@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix baseurl: <http://example.data/event/>.
baseurl:89d6654f-f6fa-4253-8a1c-04cbefc1c0a7 baseurl:id "89d6654f-f6fa-4253-8a1c-04cbefc1c0a7"; baseurl:startDate "2022-08-25"^^xsd:date; baseurl:endDate "2022-08-28"^^xsd:date.
baseurl:242621d1-830e-4fd9-8f8a-f217b5e66c66 baseurl:id "242621d1-830e-4fd9-8f8a-f217b5e66c66"; baseurl:startDate "2022-08-26"^^xsd:date; baseurl:endDate "2022-08-31"^^xsd:date.
baseurl:1dacd22b-5f14-437c-bb3f-ac05b4fa0b3e baseurl:id "1dacd22b-5f14-437c-bb3f-ac05b4fa0b3e"; baseurl:startDate "2022-12-10"^^xsd:date; baseurl:endDate "2022-12-15"^^xsd:date.
baseurl:79f73958-9205-47c9-bb77-606a265dc399 baseurl:id "79f73958-9205-47c9-bb77-606a265dc399"; baseurl:startDate "2022-06-20"^^xsd:date; baseurl:endDate "2022-06-25"^^xsd:date.
baseurl:9ae17697-fa1a-4fde-9ace-b1a5eca1e089 baseurl:id "9ae17697-fa1a-4fde-9ace-b1a5eca1e089"; baseurl:startDate "2022-08-12"^^xsd:date; baseurl:endDate "2022-08-14"^^xsd:date.
baseurl:7b868184-febc-45b2-90ab-1d856c6389ab baseurl:id "7b868184-febc-45b2-90ab-1d856c6389ab"; baseurl:startDate "2022-06-20"^^xsd:date; baseurl:endDate "2022-06-30"^^xsd:date.</textarea>
                <br>
                <input type="button" value="Submit" id="send_data_button">
        </form>
        
        
        <div>RESULTS to be loaded here...<pre id="results">NO DATA TO SHOW  </pre></div>
        

    </body>
</html>